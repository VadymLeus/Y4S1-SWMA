@startuml

|Користувач|
start
:Натискає "Створити сайт";
:Переходить на сторінку створення;

|Система (Бекенд / БД)|
:Завантажує список шаблонів
(з табл. `templates`);

|Користувач|
:Відображається форма;
:Обирає шаблон;
:Вводить назву сайту;
:Вводить унікальний URL (site_path);
:Натискає "Створити";

|Система (Бекенд / БД)|
:Отримує дані;
fork
    :Валідація даних
    (напр. URL не містить пробілів);
fork again
    :Перевірка правил
    (напр. ліміт сайтів користувача);
end fork

if (Дані валідні?) then (Так)
    :Перевірка унікальності URL
    (SELECT * FROM `sites` WHERE `site_path` = ?);
    if (URL унікальний?) then (Так)
        :Створює новий запис у `sites`
        (user_id, site_path, template_id,
        default_block_content...);
        :Перенаправляє на дашборд сайту
        (/dashboard/:site_path);
        stop
    else (Ні)
        |Користувач|
        :Повідомити про помилку
        "Ця адреса вже зайнята";
        stop
    endif
else (Ні)
    |Користувач|
    :Повідомити про помилку
    (напр. "Некоректна адреса");
    stop
endif

@enduml